@model IEnumerable<gacha.Models.shipping>

@{
    ViewData["Title"] = "Index";
}
@section Styles {
    <link href="~/lib/datatables/css/jquery.datatables.min.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/css/datatables.css" rel="stylesheet" />

    <style>
        /* 出貨卡片的顏色 */
        .btn-selected {
            background-color: #F6EEA2;
        }

        .btn-group .card.btn {
            transition: none;
        }
       
        .btn-group:hover {
            background-color: #FFFFCE;
            }
    </style>
}

<h1>出貨單</h1>
<div class="btn-group" role="group" aria-label="Status Filters">
    <div id="all" class="card btn btn-selected">
        <div class="card-body">
            <h5 class="card-title">全部</h5>
            <p class="card-text">@ViewBag.all_count</p>
        </div>
    </div>
    <div id="shipping" class="card btn ">
        <div class="card-body">
            <h5 class="card-title">已發貨</h5>
            <p class="card-text">@ViewBag.shipping_count</p>
        </div>
    </div>
    <div id="await" class="card btn ">
        <div class="card-body">
            <h5 class="card-title">待處理</h5>
            <p class="card-text">@ViewBag.await_count</p>
        </div>
    </div>
    <div id="cancel" class="card btn ">
        <div class="card-body">
            <h5 class="card-title">已取消</h5>
            <p class="card-text">@ViewBag.cancel_count</p>
        </div>
    </div>
    <div id="done" class="card btn ">
        <div class="card-body">
            <h5 class="card-title">已完成</h5>
            <p class="card-text">@ViewBag.done_count</p>
        </div>
    </div>
</div>

<table id="table" class="table my-3">

</table>
@foreach (var item in Model)
{
    @* DetailModal *@
    <div class="modal fade" id="shippingDetail-@item.id" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">出貨明細</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <partial name="_shippingDetail_partial" model="@item.id">
                </div>
            </div>
        </div>
    </div>
    @* EditModal *@
    <div class="modal fade" id="shippingEdit-@item.id" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">編輯出貨單</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <partial name="_shippingEdit_partial" model="@item">
                </div>
            </div>
        </div>
    </div>
}

@section Scripts {
    <script src="~/lib/datatables/js/jquery.datatables.min.js"></script>
    <script src="~/js/datatables.js"></script>
    <script src="~/js/delete_sweetalert.js"></script>
    <script src="~/js/delete_function_sweetalert.js"></script>

    <script>
        function updateShipping(statusChinese) {
            $.ajax({
                type: "GET",
                url: `@Url.Action("ShippingStatus", "shippings")/${statusChinese}`,
            }).done(data => {

                // 在加載新數據後重新初始化 DataTables
                // 抓到table並塞入資料data
                $('table').html(data).DataTable();

            }).fail(err => {
                alert(err.responseText);
            });
        }

        $(document).ready(function () {
            // 初始化時設置"全部"卡片為選中狀態
            $('#all').addClass('btn-selected');
            updateShipping("全部");

            $('.card').on('click', function (e) {
                let card = $(this);
                let statusID = card.attr('id');
                var statusChinese = "";
                switch (statusID){
                    case "all":
                        statusChinese = "全部"
                        break;
                    case "shipping":
                        statusChinese = "已發貨"
                        break;
                    case "await":
                        statusChinese = "待處理"
                        break;
                    case "cancel":
                        statusChinese = "已取消"
                        break;
                    case "done":
                        statusChinese = "已完成"
                        break;
                }
                console.log(statusChinese);
                updateShipping(statusChinese);

                // 更新選中狀態
                $('.card').removeClass('btn-selected');
                card.addClass('btn-selected');
            });
            
        });
        // $('table').DataTable();

    </script>

   
}
