@{
    ViewData["Title"] = "追蹤清單";
}

@section Styles
{
    <style>
        .tracking-list {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        }

            .tracking-list th, .tracking-list td {
                padding: 12px 15px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }

            .tracking-list th {
                background-color: #f8f8f8;
                color: #333;
                font-weight: bold;
                text-transform: uppercase;
            }

            .tracking-list tr:hover {
                background-color: #f5f5f5;
            }

        .machine-image {
            width: 200px; /* 調整為更小的尺寸 */
            height: 200px; /* 調整為更小的尺寸 */
            object-fit: cover;
            border-radius: 5px;
        }

        .btn {
            padding: 6px 12px;
            text-decoration: none;
            color: white;
            border-radius: 4px;
            display: inline-block;
            margin-right: 5px;
            transition: background-color 0.3s;
        }

        .btn-view {
            background-color: #4CAF50;
        }

            .btn-view:hover {
                background-color: #45a049;
            }

        .btn-delete {
            background-color: #f44336;
        }

            .btn-delete:hover {
                background-color: #da190b;
            }
    </style>
}

<div id="app">
    <table class="tracking-list" v-if="trackedMachines.length > 0">
        <thead>
            <tr>
                <th>機台圖片</th>
                <th>機台名稱</th>
                <th>所需點數</th>
                <th>操作</th>
            </tr>
        </thead>
        <tbody>
            <tr v-for="machine in trackedMachines" :key="machine.gachaMachineId">
                <td><img :src="getPictureUrl(machine.gachaMachineId)" :alt="machine.gachaMachineName" class="machine-image"></td>
                <td>{{ machine.gachaMachineName }}</td>
                <td>{{ machine.price }}</td>
                <td>
                    <a :href="'/machine/' + machine.gachaMachineId" class="btn btn-view">查看</a>
                    <button @@click="deleteTracking(machine.gachaMachineId)" class="btn btn-delete">刪除</button>
                </td>
            </tr>
        </tbody>
    </table>
    <p v-else>您的追蹤清單目前是空的。</p>
</div>

@section Scripts {
    <script src="https://unpkg.com/vue@3.4.31/dist/vue.global.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.2/axios.min.js"
            integrity="sha512-JSCFHhKDilTRRXe9ak/FJ28dcpOJxzQaCd3Xg8MyF6XFjODhy/YMCM8HW0TFDckNHWUewW+kfvhin43hKtJxAw=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        var vueApp = {
            data() {
                return {
                    trackedMachines: [],
                    baseAddress: "https://localhost:7134",
                    userId: 1 // 假設當前用戶ID為1，實際應用中應該從登錄系統獲取
                }
            },
            methods: {
                fetchTrackedMachines() {
                    axios.get(`${this.baseAddress}/api/TrackingLists/${this.userId}`)
                        .then(response => {
                            this.trackedMachines = response.data;
                        })
                        .catch(error => {
                            console.error('Error fetching tracked machines:', error);
                        });
                },
                getPictureUrl(id) {
                    return `${this.baseAddress}/api/GachaMachines/GetPicture/${id}`;
                },
                deleteTracking(gachaMachineId) {
                    axios.delete(`${this.baseAddress}/api/TrackingLists/${this.userId}/${gachaMachineId}`)
                        .then(response => {
                            console.log(response.data);
                            this.trackedMachines = this.trackedMachines.filter(machine => machine.gachaMachineId !== gachaMachineId);
                        })
                        .catch(error => {
                            console.error('Error deleting tracking:', error);
                        });
                }
            },
            mounted() {
                this.fetchTrackedMachines();
            }
        };
        var app = Vue.createApp(vueApp).mount("#app");
    </script>
}